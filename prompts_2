PERSONA:

CONTEXT:

FORMAT:

Think hard about this step by step.

Explain your chain of thought.

Verify and analyze your initial output to identify ways that your output may be incomplete.
Then articulate how your intial output either may, or may not, be improved on baed on objective metrics and standards.
Then revise your outout based on these findings and observations to craft your final output.
Present any subjective or equivocal choices with explanations on pros and cons as alternative choices.

Provide sources where I can learn more.

In any step by step process, present the steps one by one before presenting following steps.
Allow me the opportunity to clarify my understanding and/or completion of each step before proceeding to the following step.
Make adjustments and improvements on steps based on my understnading and acknowledgement of each previous step.

----

You are my senior dev partner helping me leave clear notes for my future self.

I am going to paste a code file or a long code chunk. Your job is to read it and then produce ONLY:

1) A short “Data Legend” comment block at the top, and  
2) A short “Notes for Future Me” comment block at the top.

Do NOT rewrite or reformat my code. Do NOT change any variable names. Do NOT add any new code chunks. Just give me two comment blocks that I can paste in above the existing code.

Guidelines:

- First, infer what the main data objects represent.
  - For each key data frame / table / object, list:
    - What one row represents
    - The most important columns and what they mean
    - The time scope if relevant (daily, monthly, yearly, YTD)
- Second, summarize what the main steps or sections of the code do, in plain language.

Output format:

1) Start with a comment block titled "DATA LEGEND (for future me)".
   - Use the correct comment syntax for the language you see:
     - R: `#`
     - Python: `#`
     - SQL: `--`
     - PowerShell: `#`
   - One bullet or short line per object, for example in R:
     # DATA LEGEND (for future me)
     # etc.

2) Then a second comment block titled "NOTES FOR FUTURE ME".
   - 3 to 7 bullets.
   - Focus on:
     - What the pipeline is trying to show (story or outcome)
     - Any tricky parts to remember (grouping level, joins, filters, date assumptions)
     - Any fragile assumptions that might break when the data changes
   - Keep sentences short and direct.

3) Do NOT include my original code. Do NOT show anything else besides these two comment blocks.

When I paste the code, read it, infer the intent, and then return ONLY those two comment blocks ready for me to paste at the top of the file.

---

I need to implement [fill] in [language].
Key requirements:
1. [1]
2. [2]
3. [3]
Make sure to consider:
- Error handling
- Edge cases
- Performance optimization
- Best practices for [language/framework]
Please do not unnecessarily remove any comments or code.
Generate the code with clear comments explaining the logic.

---

Explain the following part of the code in detail:
[code section]
Specifically:
1. What is the purpose of this section?
2. How does it work?  Explain step-by-step.
3. Are there any potential issues or limitations with this approach?
4. Explain the options to this approach.

---

Implement a [fill] in [language]. Please include:
1. The main function with clear parameter and return types
2. Helper functions if necessary
3. Time and space complexity analysis
4. Example usage

---

Optimize the following piece of code:
[code]
Suggest optimizations to improve its performance.
For each suggestion, explain the expected improvement and any trade-offs.
Explain options step by step.

---

I need to optimize the following SQL query:
[query]

The query is currently [problem]. 

Please:
1. Analyze the query and identify potential performance issues.
2. Suggest optimizations, which may include:
   - Rewriting the query
   - Adding or modifying indexes
   - Suggestions for schema changes if necessary
3. Explain the reasoning behind each optimization.
4. If possible, provide an estimate of the performance improvement we might expect.
Additional context:
- Database system: [e.g., PostgreSQL, MySQL]
- Any relevant hardware constraints
- Keep all suggestions within best practics and consistent with Tidy Data principles
